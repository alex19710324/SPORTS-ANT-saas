# PRD-024：运动数据与健康监测（适配Trae开发）

## 1. 概述
- **目标用户**：运动玩家、导玩员、运行专员、健康管理师、排行榜参与者。
- **核心价值**：通过可穿戴设备（运动手环、智能手表）与场馆设备的联动，实时采集用户的运动数据（卡路里消耗、心率、步数、运动时长），提供数据可视化、排行榜竞技、健康报告，增强用户粘性与社交互动，打造“数字运动+健康管理”的差异化体验。
- **技术目标**：基于Spring Boot微服务架构，集成物联网数据接入（蓝牙/WiFi）、数据中台（实时/离线分析）、AI底座（运动建议），支持主流手环品牌（小米、华为、Apple Watch等），数据同步延迟≤5分钟，排行榜实时刷新。

## 2. 用户故事
- 作为**运动玩家**，我想要在门店体验时将手环与设备绑定，实时看到我的卡路里消耗、心率变化，并参与店内排行榜竞赛，获得积分奖励。
- 作为**导玩员**，我想要帮助顾客连接手环，查看他们的运动数据，引导他们挑战更高记录。
- 作为**运行专员**，我想要通过后台查看全场用户的运动数据分布，发现热门运动项目，策划针对性活动。
- 作为**健康管理师**（如门店合作机构），我想要获取用户的运动数据（经授权），生成健康报告，提供运动建议。

## 3. 功能列表（按优先级）

### 3.1 手环/手表绑定（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| HD01 | 手环品牌接入 | 支持主流运动手环（小米手环、华为手环、Apple Watch）的数据接入，通过蓝牙/API获取实时数据。 | 各品牌SDK/开放接口 | 绑定成功率≥95% |
| HD02 | 用户绑定流程 | 用户在小程序端扫描设备二维码或手动搜索，完成手环绑定，授权数据共享。 | 蓝牙通信 + OAuth | 绑定流程≤30秒 |
| HD03 | 设备解绑 | 支持用户随时解绑手环，数据停止同步。 | 接口：`DELETE /api/band/unbind` | 解绑及时 |

### 3.2 运动数据采集（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| HD04 | 实时数据采集 | 在用户运动过程中，实时采集心率、卡路里、步数、运动时长，每30秒上传一次。 | 蓝牙数据通道 + WebSocket | 数据丢失率≤1% |
| HD05 | 运动项目关联 | 系统自动识别用户正在体验的项目（如蹦床、VR跑步），并将运动数据与项目关联。 | 设备定位 + 时间匹配 | 关联准确率≥90% |
| HD06 | 离线数据同步 | 若网络中断，手环本地存储数据，联网后自动补传。 | 本地缓存 + 断点续传 | 数据完整性≥99% |

### 3.3 数据可视化与报告（P1）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| HD07 | 运动数据看板 | 在小程序内展示用户当日/累计卡路里、运动时长、心率曲线、运动项目分布。 | ECharts图表 | 加载≤2秒 |
| HD08 | 运动报告生成 | 每周自动生成运动报告，包含消耗总量、项目分析、进步曲线、健康建议。 | AI底座（健康建议） | 报告生成≤10秒 |
| HD09 | 隐私保护 | 用户可设置数据可见范围（仅自己/好友/公开），心率等敏感数据默认不公开。 | 权限控制 | 数据安全 |

### 3.4 排行榜与竞技（P1）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| HD10 | 实时排行榜 | 按门店、区域、全国展示卡路里消耗/运动时长排名，支持按日/周/月筛选。 | Redis有序集合 | 实时刷新 |
| HD11 | 挑战任务 | 系统自动推送挑战任务（如“今日消耗500卡”），完成后获得积分/NFT奖励。 | 规则引擎 | 任务完成率追踪 |
| HD12 | 团队竞技 | 支持用户组队，团队总消耗排名，增强社交互动。 | 组队系统 | 团队数据准确 |

### 3.5 健康管理延伸（P2）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| HD13 | 健康建议 | 基于用户运动数据，AI推荐个性化运动计划、饮食建议。 | AI健康模型 | 建议有用率≥70% |
| HD14 | 第三方机构合作 | 经用户授权，可将运动数据共享给合作健身房、健康管理机构，生成专业报告。 | OAuth授权 + API | 数据安全传输 |

## 4. 技术架构
- **前端**：小程序（蓝牙通信）、Vue3后台。
- **后端**：Spring Boot + Netty（蓝牙网关）+ Redis（排行榜）。
- **数据**：MySQL（用户手环信息）、InfluxDB（时序数据）、Redis（实时排行）。
- **底座依赖**：
  - AI底座：健康建议生成。
  - 会员系统：积分奖励。
  - KOC系统：挑战任务联动。

## 5. 接口设计示例
- **手环绑定**：
  - `POST /api/band/bind`
  - 请求：
    ```json
    {
      "userId": 12345,
      "bandType": "xiaomi",
      "bandMac": "AA:BB:CC:DD:EE:FF",
      "authCode": "xxxx"
    }
    ```
  - 响应：`{ "bandId": 5001, "status": "bound" }`

- **上传运动数据**（设备端）：
  - `POST /api/band/data`
  - 请求：
    ```json
    {
      "bandId": 5001,
      "timestamp": "2025-03-03T10:30:00Z",
      "heartRate": 120,
      "calories": 150,
      "steps": 2000,
      "duration": 600
    }
    ```

## 6. 验收标准
- 手环绑定成功率≥95%。
- 数据采集丢失率≤1%。
- 排行榜实时刷新（延迟≤2秒）。
- 用户可随时解绑，数据停止采集。
- 符合GDPR/PIPL隐私要求。

## 7. 依赖模块
- **AI底座**：健康建议。
- **会员系统**：积分奖励。
- **KOC系统**：挑战任务。
- **数据中台**：运动数据分析。

---
**版本历史**：
| 版本 | 日期 | 修改内容 | 作者 |
|------|------|----------|------|
| V1.0 | 2025-03-03 | 初始版本，基于运动手环及健康监测需求 | 产品团队 |