# PRD-003：门店运营管理后台（SaaS后台·适配Trae开发）

## 1. 概述
- **目标用户**：品牌总部运营者、区域管理人员、门店店长、副店长、值班经理等。
- **核心价值**：提供一站式门店运营管理平台，实现多租户数据隔离、灵活权限配置、实时数据监控、营销活动管理、会员与积分管理、硬件与库存管控，助力门店高效运营与决策。
- **技术目标**：基于Spring Boot + Vue3微服务架构，通过AI底座、语言底座、通讯社媒底座、财务底座实现全球化运营。后台需支持多语言切换（中/英/西/法等），权限精细到按钮级别，数据实时同步。

## 2. 用户故事
- 作为**总部运营**，我想要创建并配置新门店（租户），设置品牌视觉、运营规则、支付渠道，以便快速扩张。
- 作为**区域经理**，我想要查看辖区内所有门店的实时数据（营收、客流、设备状态），并能下发统一营销活动。
- 作为**门店店长**，我想要配置门店项目、预约规则、核销方式，管理会员等级与积分，查看经营报表，审批员工申请。
- 作为**值班经理**，我想要调整当班排班、处理库存预警、监控硬件故障、审核客诉处理。
- 作为**市场专员**，我想要创建营销活动（秒杀/拼团/储值），配置KOC专属任务，追踪活动效果。
- 作为**财务人员**，我想要查看财务报表、成本分析、税务申报数据，并进行对账审批。

## 3. 功能列表（按优先级）

### 3.1 租户与权限管理（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| T01 | 租户创建与配置 | 支持新增门店租户，配置基础信息（名称、地址、联系方式、时区、默认语言），选择计费套餐。 | 接口：`POST /api/tenants`，数据独立Schema自动创建。 | 租户开通后独立数据隔离 |
| T02 | 品牌个性化配置 | 支持上传LOGO、主色调、Banner图，配置IP主题（如赛博朋克风格），KOC专属视觉标识。 | 文件存储OSS，配置实时推送至小程序。 | 配置变更10秒内生效 |
| T03 | 岗位与权限管理 | 预设岗位模板（店长、值班经理、前台、导玩员、技术员等），支持自定义岗位及权限集（菜单、按钮、数据范围）。 | RBAC模型，权限注解控制。 | 权限调整实时生效 |
| T04 | 员工账号管理 | 增删改查员工账号，关联岗位，支持批量导入。员工登录方式支持企微/钉钉/飞书（国内）及Slack/Teams（海外）。 | 接口：`/api/employees`，同步通讯社媒底座。 | 账号同步≤5秒 |

### 3.2 门店基础配置（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| S01 | 门店信息管理 | 配置门店营业时间、联系电话、位置（经纬度）、3D模型文件上传。 | 接口：`/api/stores` | 信息实时同步 |
| S02 | 项目管理 | 增删改查门店项目（如蹦床、VR、保龄球、盲盒机），配置项目类型、体验时长、价格、时段规则、安全须知。 | 接口：`/api/projects`，时段配置JSON存储。 | 项目变更前端实时生效 |
| S03 | 预约规则配置 | 设置可预约时段、最大人数、提前预约时长、取消政策（免费取消时间、扣费比例）、定金规则、排队规则。 | 接口：`/api/booking/rules` | 规则立即生效 |
| S04 | 核销方式配置 | 启用/禁用核销方式（二维码/人脸识别/蓝牙/第三方凭证），配置人脸识别协议签署、第三方平台对接（美团/抖音等）。 | 接口：`/api/redemption/methods`，对接第三方SDK。 | 核销成功响应≤2秒 |
| S05 | 硬件管理 | 添加/删除硬件设备（核销终端、闸机、VR设备等），查看在线状态、固件版本，远程升级/重启。 | MQTT协议，接口：`/api/devices` | 状态实时刷新 |

### 3.3 会员与积分管理（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| M01 | 会员等级配置 | 自定义等级名称（工蚁先锋至圣蚁尊者）、升级条件（消费金额、互动次数）、等级权益（积分加成、排队优先等）。 | 接口：`/api/membership/levels` | 规则变更后会员等级自动重新计算 |
| M02 | 积分规则配置 | 配置积分获取规则（消费1元=1积分，分享=10积分等）、兑换规则（100积分=1元抵扣，上限30%）、积分有效期。 | 接口：`/api/membership/points-rules` | 规则实时生效 |
| M03 | 用户同意管理 | 查看用户签署协议记录（注册协议、人脸识别协议、KOC协议），支持撤销同意。 | 接口：`/api/membership/consents` | 日志可追溯 |
| M04 | 会员标签管理 | 手动或AI自动打标签（如“高潜KOC”、“沉睡会员”），支持标签筛选群发消息。 | 接口：`/api/membership/tags` | 标签准确率≥90% |

### 3.4 盲盒与NFT管理（P1）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| B01 | 盲盒商品配置 | 增删改查盲盒商品（名称、系列、图片、价格、库存），配置开箱概率、成本构成（物料/运营/利润）。 | 接口：`/api/blindboxes`，概率配置需合规备案。 | 概率公示准确 |
| B02 | NFT藏品管理 | 配置NFT模板（名称、系列、发行量、稀有度、权益说明），设置发放规则（购买盲盒赠送/KOC空投）。 | 接口：`/api/nft/templates`，集成联盟链。 | 发行记录上链 |
| B03 | 盲盒成本透明化 | 配置成本字段，支持总部统一或门店微调，成本与KOC提成联动（利润低于15%时限制高提成）。 | 接口：`/api/blindboxes/cost` | 成本数据实时同步 |

### 3.5 营销活动管理（P1）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| A01 | 活动创建 | 创建营销活动（秒杀、拼团、储值、打卡挑战、排行榜），配置时间、规则、奖励、参与门店。 | 接口：`/api/marketing/activities`，工作流审批。 | 活动准时发布 |
| A02 | 社交裂变玩法 | 配置好友助力规则、潮玩打卡任务、分享奖励。 | 接口：`/api/marketing/social` | 数据实时追踪 |
| A03 | KOC任务系统 | 配置KOC裂变任务（如新品推广、社群招募），自动派发素材，设置提成比例。 | AI底座生成素材，通讯社媒分发。 | 任务完成率可监控 |
| A04 | 活动效果看板 | 实时查看活动参与人数、核销数、营收、ROI，支持导出报表。 | 接口：`/api/marketing/stats` | 数据延迟≤5分钟 |

### 3.6 数据统计与报表（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| D01 | 实时数据看板 | 展示今日客流、营收、核销数、盲盒销售额、KOC贡献、设备在线率、预警数。 | 聚合查询，Redis缓存。 | 延迟≤5秒 |
| D02 | 报表导出 | 支持按时间段导出客流报表、营收报表、会员报表、KOC报表，Excel/PDF格式，敏感数据脱敏。 | 接口：`/api/reports/export`，审批流。 | 导出记录可追溯 |
| D03 | 自定义报表 | 拖拽字段生成自定义报表，保存模板，支持定时发送。 | 接口：`/api/reports/custom` | 模板灵活 |

### 3.7 财务相关（P1，部分P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| F01 | 押金管理配置 | 开启押金功能，设置金额、退还条件、退还时限，异常处理。 | 接口：`/api/finance/deposit` | 押金流程闭环 |
| F02 | 成本分析 | 查看门店各项成本（人工、物料、能耗），支持成本分摊规则调整。 | 财务底座接口 | 数据实时 |
| F03 | 财务报表 | 查看利润表、资产负债表，支持钻取。 | 接口：`/api/finance/statements` | 准确无误 |

### 3.8 通讯社媒管理（P1）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| CM01 | 账号绑定 | 绑定企微、公众号、抖音、Facebook、Instagram等账号。 | OAuth2授权 | 绑定成功率≥99% |
| CM02 | 消息中心 | 统一查看各渠道客户咨询，分配客服，快捷回复。 | 消息路由引擎 | 消息延迟≤500ms |
| CM03 | 内容发布 | 创建图文/视频内容，一键分发至多平台，定时发布。 | 素材适配引擎 | 发布成功率≥99.9% |
| CM04 | 自动化营销 | 配置触发式营销流程（如新粉丝关注自动发送欢迎语）。 | 工作流引擎 | 执行准确 |

### 3.9 多语言配置（P1）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| L01 | 语言包管理 | 上传/更新语言包（JSON），支持版本控制，热更新。 | 接口：`/api/i18n/upload`，CDN分发。 | 更新后立即生效 |
| L02 | 门店默认语言 | 设置门店默认语言，新用户首次访问时使用。 | 接口：`/api/stores/language` | 切换准确 |

### 3.10 其他（P1）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| O01 | 设备二维码配置 | 为设备生成专属启动二维码，关联数据（分数、卡路里），设置排行奖励。 | 接口：`/api/devices/qrcode` | 二维码有效 |
| O02 | 相册分享配置 | 开启相册分享，设置存储时长、水印、审核机制。 | 接口：`/api/social/album` | 用户上传可管理 |

## 4. 技术架构
- **前端**：Vue3 + TypeScript + Element Plus（国内）/ Vuetify（海外），微前端架构，支持多语言切换。
- **后端**：Spring Boot微服务，API网关统一认证（JWT），权限控制使用Spring Security + 自定义注解。
- **数据**：MySQL（业务数据）+ Redis（缓存）+ ClickHouse（报表数据）。
- **底座依赖**：
  - AI底座：KOC任务素材生成、活动效果预测。
  - 语言底座：多语言切换、动态翻译。
  - 通讯社媒底座：消息中心、内容分发、账号绑定。
  - 财务底座：成本数据、财务报表、押金管理。

## 5. 接口设计示例
- **租户创建接口**：
  - `POST /api/tenants`
  - 请求：
    ```json
    {
      "name": "深圳Party Day",
      "country": "CN",
      "timezone": "Asia/Shanghai",
      "defaultLang": "zh-CN",
      "address": "深圳市福田区XX路",
      "contactPhone": "0755-12345678"
    }
    ```
  - 响应：`{ "tenantId": 1001, "status": "active" }`

- **项目配置接口**：
  - `POST /api/projects`
  - 请求：
    ```json
    {
      "storeId": 1001,
      "name": "蹦床",
      "type": "sports",
      "duration": 60,
      "price": 80.0,
      "slotConfig": {
        "startTime": "09:00",
        "endTime": "22:00",
        "interval": 30,
        "maxPerSlot": 20
      },
      "safetyNotice": "请勿携带尖锐物品..."
    }
    ```
  - 响应：`{ "projectId": 2001 }`

## 6. 验收标准
- 所有配置项修改后，前端应在10秒内生效。
- 权限控制严格：不同岗位登录后菜单及按钮差异正确。
- 数据看板加载≤2秒，报表导出≤10秒。
- 符合GDPR/等保2.0要求：敏感数据加密、操作日志留存。
- 多语言切换覆盖所有静态文案，切换无延迟。

## 7. 依赖模块
- **AI底座**：用于KOC任务素材生成、活动效果预测。
- **语言底座**：多语言包管理、动态翻译。
- **通讯社媒底座**：消息中心、内容发布、自动化营销。
- **财务底座**：成本数据、财务报表、押金管理。
- **硬件联动网关**：设备状态监控、二维码配置。

---
**版本历史**：
| 版本 | 日期 | 修改内容 | 作者 |
|------|------|----------|------|
| V1.0 | 2025-03-02 | 初始版本，基于总体规划文档 | 产品团队 |