# PRD-035：工单与任务协同系统（适配Trae开发）

## 1. 概述
- **目标用户**：所有需要发起和处理工单的人员（员工、店长、技术员、保洁、客服等），以及工单管理员。
- **核心价值**：构建统一的工单与任务协同平台，将门店各类流程性工作（报修、投诉、采购、审批、巡检、保养）统一标准化，实现工单的自动流转、高效处理、闭环追踪，提升跨部门协同效率。
- **技术目标**：基于Spring Boot + Flowable工作流引擎，提供可视化工单配置、智能分配、时效监控、数据统计，支持与各业务模块（硬件、客服、人事、采购）深度集成，工单平均处理时效降低30%。

## 2. 用户故事
- 作为**导玩员**，我发现设备故障，扫码一键报修，工单自动分配给技术员，我实时看到处理进度。
- 作为**技术员**，我在工作台看到待处理的维修工单，点击接单，处理完成后上传维修照片，工单自动关闭。
- 作为**店长**，我需要审批采购申请，在待办列表中看到申请，点击同意后工单流转至采购员。
- 作为**工单管理员**，我想要自定义工单类型和流程（如“客诉处理需经过客服主管审核”），并监控各类型工单的SLA达成率。

## 3. 功能列表（按优先级）

### 3.1 工单模型与配置（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| TS01 | 工单类型定义 | 支持自定义工单类型（报修、投诉、采购、巡检、保养、审批），配置基础字段。 | 接口：`POST /api/workflow/types` | 类型可扩展 |
| TS02 | 工单表单设计 | 拖拽式表单设计器，为不同工单类型设计字段（如报修需上传照片，采购需关联供应商）。 | 表单引擎 | 设计灵活 |
| TS03 | 工单流程配置 | 基于BPMN的可视化流程设计器，配置工单流转节点、审批人、条件分支。 | Flowable集成 | 流程可配置 |
| TS04 | SLA配置 | 为工单类型设置响应时限、处理时限，超时自动升级提醒。 | 规则引擎 | 提醒准时 |

### 3.2 工单发起与受理（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| TS05 | 多渠道发起 | 员工可从工作台、扫码、关联业务模块（如设备故障自动生成）发起工单。 | 接口：`POST /api/workflow/tickets` | 发起成功 |
| TS06 | 智能分配 | 根据工单类型、区域、技能标签、当前负载，自动分配给最合适的人员。 | 规则引擎 | 分配准确率≥90% |
| TS07 | 工单受理 | 处理人可接单、转单、填写处理过程、上传附件、申请延期。 | 接口：`POST /api/workflow/tickets/{id}/process` | 操作可追溯 |

### 3.3 工单追踪与协作（P1）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| TS08 | 工单详情看板 | 展示工单全生命周期（流转记录、处理过程、附件），支持评论、@相关人员。 | 实时通信 | 信息完整 |
| TS09 | 消息提醒 | 工单状态变化时，通过小程序/企微/邮件通知相关人。 | 通讯社媒底座 | 推送成功率≥99% |
| TS10 | 协作群 | 复杂工单可自动创建临时协作群，相关人员在群内沟通。 | 企微集成 | 建群成功 |

### 3.4 工单统计与分析（P1）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| TS11 | 工单看板 | 实时展示各类工单数量、处理中、超时工单，按类型/人员分布。 | 数据中台 | 刷新≤5秒 |
| TS12 | SLA报表 | 统计各类型工单平均响应时间、平均处理时间、SLA达成率。 | 报表引擎 | 数据准确 |
| TS13 | 员工工单绩效 | 统计个人处理工单数、满意度、超时率，纳入绩效考核。 | HR系统联动 | 数据同步 |

## 4. 技术架构
- **前端**：Vue3 + Element Plus（后台），嵌入员工工作台。
- **后端**：Spring Boot + Flowable工作流引擎。
- **数据**：MySQL（工单、流程）、Elasticsearch（日志）、Redis（缓存）。
- **底座依赖**：
  - 通讯社媒底座：消息推送。
  - 数据中台：报表。
  - 各业务模块：工单来源。

## 5. 接口设计示例
- **创建工单**：
  - `POST /api/workflow/tickets`
  - 请求：
    ```json
    {
      "type": "repair",
      "title": "VR设备屏幕不亮",
      "priority": "high",
      "description": "设备编号VR-003，屏幕无显示",
      "attachments": ["url"],
      "sourceId": "device-003",
      "sourceType": "device"
    }
    ```

## 6. 验收标准
- 工单流转符合配置流程。
- 智能分配准确率≥90%。
- 超时提醒准时。
- 报表数据准确。

## 7. 依赖模块
- **通讯社媒底座**：通知。
- **数据中台**：统计。
- **各业务模块**：工单来源。

---
**版本历史**：
| 版本 | 日期 | 修改内容 | 作者 |
|------|------|----------|------|
| V1.0 | 2025-03-03 | 初始版本 | 产品团队 |