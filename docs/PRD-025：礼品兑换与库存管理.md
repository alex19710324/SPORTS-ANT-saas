# PRD-025：礼品兑换与库存管理（适配Trae开发）

## 1. 概述
- **目标用户**：仓管员、兑换处员工、店长、采购专员、财务人员。
- **核心价值**：实现门店礼品（实物礼品、潮玩手办、IP周边等）的全生命周期管理，从入库、出库、兑换、盘点、补货到成本核算，确保账实相符，优化库存周转，提升顾客兑换体验。
- **技术目标**：基于Spring Boot + Vue3微服务架构，集成库存引擎、条码/RFID识别、财务底座（成本核算）、预警引擎，支持多门店调拨、跨境补货，库存准确率≥99.9%。

## 2. 用户故事
- 作为**兑换处员工**，我想要快速扫描顾客会员卡或彩票，系统自动显示可兑换礼品列表，完成兑换后自动扣减库存，打印兑换小票。
- 作为**仓管员**，我想要实时查看各类礼品库存，接收库存预警，发起采购/调拨申请，定期盘点并录入系统。
- 作为**店长**，我想要查看礼品兑换排行榜、库存周转率，了解热门礼品，优化采购决策。
- 作为**财务人员**，我想要核对礼品库存账与财务账的一致性，分析礼品成本与毛利。

## 3. 功能列表（按优先级）

### 3.1 礼品档案管理（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| GI01 | 礼品信息配置 | 增删改查礼品基础信息（名称、系列、图片、规格、条码、供应商、采购价、建议兑换积分/票数）。 | 接口：`/api/gifts` | 信息准确 |
| GI02 | 礼品分类 | 支持多级分类（如潮玩手办、IP周边、实用礼品、限量版），便于查找。 | 树形结构 | 分类清晰 |
| GI03 | 条码/RFID管理 | 支持为礼品生成内部条码或关联RFID标签，便于出入库扫描。 | 条码生成/打印 | 扫描识别率≥99% |

### 3.2 库存管理（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| GI04 | 入库管理 | 采购到货后，扫描条码录入入库单（数量、批次、有效期、存放货位），自动增加库存。 | 接口：`POST /api/inventory/inbound` | 入库记录实时 |
| GI05 | 出库管理 | 兑换、调拨、报损时生成出库单，扫描/手动录入，自动扣减库存。 | 接口：`POST /api/inventory/outbound` | 出库准确 |
| GI06 | 实时库存查询 | 按门店、货位、礼品查询实时库存，支持导出。 | 接口：`GET /api/inventory/stock` | 查询响应≤2秒 |
| GI07 | 库存预警 | 设置安全库存阈值，低于阈值时自动提醒采购。 | 规则引擎 | 预警及时 |
| GI08 | 盘点管理 | 生成盘点单，扫码盘点，录入实盘数量，自动生成盘盈盘亏单，经审批后调整库存。 | 接口：`POST /api/inventory/check` | 盘点流程闭环 |

### 3.3 礼品兑换（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| GI09 | 兑换规则配置 | 支持配置礼品所需积分/彩票数，可设置会员等级折扣、限兑数量。 | 规则引擎 | 规则生效 |
| GI10 | 兑换核销 | 顾客出示会员卡/二维码，系统读取可用积分/彩票，展示可兑换礼品，选择后扣减库存，生成兑换记录。 | 接口：`POST /api/gifts/redeem` | 兑换成功率≥99% |
| GI11 | 小票打印 | 兑换完成后自动打印小票（含礼品清单、剩余积分）。 | 打印服务 | 打印成功 |

### 3.4 调拨与补货（P1）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| GI12 | 门店调拨 | 支持门店间礼品调拨，发起调拨申请，审批后发货/收货，双方库存实时更新。 | 接口：`POST /api/inventory/transfer` | 调拨流程完整 |
| GI13 | 自动补货建议 | 基于销量预测和库存预警，自动生成补货建议单，推送采购模块。 | AI预测 + 规则 | 建议采纳率≥80% |

### 3.5 成本与财务联动（P1）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| GI14 | 成本核算 | 支持移动加权平均、先进先出等成本核算方式，自动计算发出成本，同步至财务底座。 | 财务底座接口 | 成本准确 |
| GI15 | 兑换收入统计 | 统计各礼品兑换次数、消耗积分/彩票数、成本、毛利，生成报表。 | 数据中台 | 报表清晰 |

## 4. 技术架构
- **前端**：Vue3 + Element Plus（后台），嵌入兑换工作台（移动端扫码）。
- **后端**：Spring Boot + 库存引擎（自研）。
- **数据**：MySQL（库存流水）、Redis（缓存）、Elasticsearch（日志）。
- **底座依赖**：
  - 财务底座：成本核算。
  - 数据中台：分析报表。
  - 供应链模块：采购联动。

## 5. 接口设计示例
- **兑换礼品**：
  - `POST /api/gifts/redeem`
  - 请求：
    ```json
    {
      "memberId": 12345,
      "giftId": 5001,
      "quantity": 1,
      "redeemPoints": 1000,
      "storeId": 1001
    }
    ```
  - 响应：
    ```json
    {
      "code": 200,
      "data": {
        "orderId": 3001,
        "remainingPoints": 4500,
        "giftName": "SP联名手办"
      }
    }
    ```

## 6. 验收标准
- 库存准确率≥99.9%。
- 兑换核销响应≤2秒。
- 盘点流程闭环，盘盈盘亏可追溯。
- 成本核算与财务一致。

## 7. 依赖模块
- **财务底座**：成本核算。
- **数据中台**：报表分析。
- **采购模块**：补货建议。

---
**版本历史**：
| 版本 | 日期 | 修改内容 | 作者 |
|------|------|----------|------|
| V1.0 | 2025-03-03 | 初始版本，整合礼品兑换与库存管理 | 产品团队 |