# PRD-061：次卡/储值卡管理（适配Trae开发）

## 1. 概述
- **目标用户**：会员、财务、运营、前台。
- **核心价值**：支持次卡、储值卡的售卖、充值、消费、退卡全流程管理，提前锁定用户消费，增强用户粘性。
- **技术目标**：基于财务底座+会员系统，集成卡密生成、余额管理、消费计次、有效期控制，支持多门店通用。

## 2. 用户故事
- 作为**会员**，我购买了一张“10次蹦床卡”，每次消费扣减次数，余额不足时提醒续费。
- 作为**前台**，用户出示会员卡/手机号，我扣除次数或余额，打印小票。

## 3. 功能列表（按优先级）

### 3.1 卡种配置（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| SC01 | 卡类型 | 支持次卡、储值卡、组合卡，可设置面值、次数、有效期、适用项目。 | 接口：`/api/stored-value/card-types` | 配置灵活 |
| SC02 | 售价与赠送 | 可设置售价、赠送金额/次数、会员等级折扣。 | 规则引擎 | 计算准确 |

### 3.2 售卖与充值（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| SC03 | 购卡 | 用户在线或线下支付购卡，系统生成卡记录，绑定会员。 | 接口：`POST /api/stored-value/buy` | 购卡成功 |
| SC04 | 充值 | 储值卡支持在线/线下充值，充值赠送自动计算。 | 接口：`POST /api/stored-value/recharge` | 到账准确 |

### 3.3 消费与核销（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| SC05 | 扣次/扣款 | 消费时验证卡有效性、余额/次数，扣减并记录流水。 | 接口：`POST /api/stored-value/consume` | 扣款准确 |
| SC06 | 退卡 | 支持退卡计算余额，原路退款，关闭卡片。 | 工作流+财务 | 退卡成功 |

### 3.4 分析与风控（P1）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| SC07 | 卡报表 | 统计售卡收入、充值金额、消费金额、沉淀资金。 | 财务底座 | 数据准确 |
| SC08 | 过期提醒 | 卡片到期前推送提醒用户使用。 | 消息中心 | 提醒及时 |

## 4. 依赖模块
- 会员系统（PRD-016）
- 财务底座（PRD-009）
- 消息通知中心（PRD-043）

---
**版本历史**：V1.0 2025-03-03