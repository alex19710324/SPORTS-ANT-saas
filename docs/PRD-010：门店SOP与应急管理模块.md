# PRD-010：门店SOP与应急管理模块（适配Trae开发）

## 1. 概述
- **目标用户**：门店店长、值班经理、安监专员、所有一线员工（需执行SOP流程或参与应急响应）。
- **核心价值**：将门店标准作业程序（SOP）数字化，实现巡检任务自动化、应急预案流程化、记录可追溯，提升门店运营规范性与安全性，确保合规经营。
- **技术目标**：基于Spring Boot + Vue3微服务架构，集成任务引擎、工作流引擎、表单引擎，与硬件联动、通讯社媒底座深度集成，支持移动端（员工工作台）和PC端（管理后台）操作。

## 2. 用户故事
- 作为**店长**，我想要在后台配置各岗位的SOP任务（如清洁频次、设备检查项目），查看任务完成情况，分析执行偏差，以便持续改进。
- 作为**值班经理**，我想要每天在移动端接收巡检任务清单，逐项检查并拍照上传，异常情况可一键报修或上报。
- 作为**保洁员**，我想要在手机上看到今日清洁任务（区域、时间、标准），完成后扫码确认，系统自动记录。
- 作为**安监专员**，我想要在突发事件发生时，根据系统推送的应急预案指引，快速执行处置步骤，并记录处理过程。
- 作为**导玩员**，我想要在遇到顾客投诉时，通过工作台查看标准处理流程，规范应对。
- 作为**总部运营**，我想要查看各门店SOP执行率、突发事件统计，评估门店管理水平。

## 3. 功能列表（按优先级）

### 3.1 SOP任务配置与管理（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| SOP01 | SOP模板库 | 总部可创建各岗位SOP模板（如保洁每日清洁任务、技术员日检项目），支持图文说明、视频链接。 | 内容管理（富文本/附件） | 模板可复用 |
| SOP02 | 门店SOP实例化 | 门店基于模板生成每日/每周任务，可调整时间、责任人。 | 接口：`POST /api/sop/instances` | 任务自动生成 |
| SOP03 | 任务配置 | 支持配置任务频次（每天/每周/每月）、触发条件（如营业前、高峰后）、截止时间。 | 定时任务引擎 | 准时触发 |
| SOP04 | 责任人分配 | 支持按岗位自动分配（如保洁任务自动分配给当日保洁员），也支持手动指派。 | 员工排班系统对接 | 分配准确 |

### 3.2 任务执行与反馈（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| SOP05 | 移动端任务看板 | 员工在个人工作台查看今日待办SOP任务，按优先级排序，点击可查看详情。 | 接口：`GET /api/sop/tasks/pending` | 实时同步 |
| SOP06 | 任务执行 | 执行任务时，可逐项确认，拍照/录像上传作为证据，填写执行记录。 | 接口：`POST /api/sop/tasks/{id}/execute` | 上传成功 |
| SOP07 | 异常上报 | 执行中发现问题（如设备损坏、卫生死角），可一键上报生成工单（报修/清洁工单）。 | 与工单系统联动 | 工单自动创建 |
| SOP08 | 任务完成度看板 | 值班经理实时查看各岗位任务完成进度，超时任务标红提醒。 | 接口：`GET /api/sop/dashboard` | 数据刷新≤5秒 |

### 3.3 巡检计划与执行（P1，与硬件联动结合）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| SOP09 | 巡检路线配置 | 后台可配置巡检路线（点位顺序），支持扫码签到（扫描NFC/二维码）。 | 接口：`POST /api/inspection/routes` | 签到成功率≥99% |
| SOP10 | 巡检计划 | 支持按天/周生成巡检计划，自动提醒责任人。 | 任务引擎 | 提醒及时 |
| SOP11 | 现场巡检 | 巡检员按路线扫码签到，填写设备状态、拍照上传，异常时自动生成维修工单。 | 接口：`POST /api/inspection/execute` | 记录完整 |

### 3.4 应急预案管理（P1）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| SOP12 | 应急预案库 | 总部可维护各类应急预案（火灾、停电、斗殴、儿童走失等），包含处置步骤、责任人、联系方式。 | 内容管理 | 预案可查 |
| SOP13 | 预案触发与推送 | 突发事件发生时，员工可在工作台一键启动对应预案，系统自动推送处置指引给相关人员。 | 通讯社媒底座推送 | 推送延迟≤3秒 |
| SOP14 | 应急事件记录 | 记录事件发生时间、地点、处置过程、结果，可上传照片/视频，形成事件报告。 | 接口：`POST /api/incident/report` | 报告完整 |
| SOP15 | 应急演练管理 | 记录演练计划、参与人员、演练结果，支持演练评估。 | 接口：`POST /api/emergency/drill` | 可追溯 |

### 3.5 培训与考核（P2）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| SOP16 | SOP培训材料 | 员工可在工作台查看SOP培训文档、视频，系统记录学习进度。 | 内容管理+学习记录 | 学习进度可查 |
| SOP17 | 在线考核 | 可配置SOP相关试题，员工在线考试，自动评分，记录成绩。 | 考试引擎 | 考核结果可导出 |

### 3.6 统计分析（P2）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| SOP18 | SOP执行率报表 | 统计各门店、各岗位SOP任务完成率、准时率、异常率。 | 数据中台 | 报表准确 |
| SOP19 | 突发事件统计 | 统计事件类型、处理时效、影响程度，生成趋势图。 | 接口：`GET /api/incident/stats` | 图表可视化 |

## 4. 技术架构
- **前端**：Vue3 + Vant（移动端）/ Element Plus（PC端），嵌入员工工作台。
- **后端**：Spring Boot微服务，集成任务引擎（Quartz）、工作流引擎（Flowable）、表单引擎（自研）。
- **数据**：MySQL（任务、记录）、Redis（缓存）、Elasticsearch（日志检索）。
- **底座依赖**：
  - 通讯社媒底座：应急事件推送、任务提醒。
  - 硬件联动网关：巡检扫码、设备状态联动。
  - AI底座：异常识别（如照片自动识别安全隐患）。

## 5. 接口设计示例
- **获取今日任务列表**：
  - `GET /api/sop/tasks/today?employeeId=xxx`
  - 响应：
    ```json
    {
      "tasks": [
        {
          "id": 1001,
          "title": "早班设备检查",
          "deadline": "10:00",
          "status": "pending",
          "items": [
            { "name": "检查屏幕", "checked": false },
            { "name": "测试投币器", "checked": false }
          ]
        }
      ]
    }
    ```

- **执行任务提交**：
  - `POST /api/sop/tasks/1001/execute`
  - 请求：
    ```json
    {
      "photos": ["url1", "url2"],
      "notes": "屏幕有轻微划痕，已记录",
      "items": [
        { "name": "检查屏幕", "checked": true, "result": "正常" },
        { "name": "测试投币器", "checked": true, "result": "正常" }
      ]
    }
    ```

## 6. 验收标准
- 任务准时提醒成功率≥99%。
- 巡检扫码签到成功率≥99%。
- 应急事件推送延迟≤3秒。
- 报表数据准确，导出≤10秒。
- 符合安全要求：操作日志完整，敏感数据脱敏。

## 7. 依赖模块
- **通讯社媒底座**：任务提醒、应急推送。
- **硬件联动网关**：巡检扫码、设备状态。
- **AI底座**：异常识别（可选）。
- **员工工作台**：移动端入口。

---
**版本历史**：
| 版本 | 日期 | 修改内容 | 作者 |
|------|------|----------|------|
| V1.0 | 2025-03-02 | 初始版本，基于SOP文档与应急方案 | 产品团队 |