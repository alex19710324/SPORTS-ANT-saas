# PRD-008：通讯及社媒底座（适配Trae开发）

## 1. 概述
- **目标用户**：所有需要社媒沟通能力的模块（员工工作台、营销系统、KOC系统）、社媒运营专员、门店员工、消费者。
- **核心价值**：为员工办公协同、客户触达、营销推广提供统一的多平台接入与管理能力，实现国内（企微/微信/抖音/小红书）与海外（WhatsApp/Facebook/Instagram/TikTok等）的深度集成，统一消息路由、营销分发、数据追踪，私域运营效率提升50%。
- **技术目标**：构建多平台接入网关、员工身份映射、消息路由引擎、营销内容分发服务、社交关系管理、数据追踪分析、自动化营销工作流，支持全球多节点部署，消息收发延迟<500ms。

## 2. 用户故事
- 作为**门店员工**，我想要使用企业微信扫码登录SaaS后台，接收系统通知、审批任务，并在企微侧边栏查看客户画像、发送优惠券，以便高效服务顾客。
- 作为**KOC**，我想要一键获取AI生成的推广素材，并分享到微信、抖音、小红书、Facebook、WhatsApp，分享链接自动追踪效果。
- 作为**市场专员**，我想要在后台统一管理公众号、抖音、Facebook主页，创建内容并定时发布，实时查看互动数据。
- 作为**客服人员**，我想要在一个消息中心处理来自微信、WhatsApp、Facebook Messenger的客户咨询，智能分配会话，快速回复。
- 作为**总部运营**，我想要配置自动化营销流程（如新粉丝关注自动发送欢迎语），并监控各渠道转化效果。

## 3. 功能列表（按优先级）

### 3.1 多平台接入与管理（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| CM01 | 国内平台接入 | 支持企业微信、微信开放平台（公众号/小程序）、抖音、小红书等平台的账号绑定与API对接。 | OAuth2授权，各平台SDK封装。 | 绑定成功率≥99% |
| CM02 | 海外平台接入 | 支持Facebook（主页/ Messenger）、Instagram、WhatsApp Business、YouTube、TikTok、Twitter等平台的账号绑定与API对接。 | 各平台Graph API/SDK | 绑定成功率≥99% |
| CM03 | 多账号管理 | 支持同一平台绑定多个账号（如多个企微、多个Facebook主页），设置主账号，账号健康度监控（封号/限流预警）。 | 接口：`/api/social/accounts`，定时检测。 | 账号状态实时更新 |
| CM04 | 回调事件处理 | 统一处理各平台回调事件（用户关注、消息、评论、订单等），验签后分发。 | Webhook网关，签名验证。 | 事件处理成功率100% |

### 3.2 员工身份与权限映射（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| CM05 | 组织架构同步 | 与企业微信/钉钉/飞书（国内）及Slack/Teams（海外）的组织架构双向同步，自动创建/更新员工账号。 | 定时同步任务，手动触发。 | 同步延迟≤5分钟 |
| CM06 | 单点登录 | 员工可使用企微/钉钉/飞书/Slack/Teams扫码登录SaaS后台，自动映射系统内角色权限。 | OAuth2/OIDC协议 | 登录成功率≥99% |
| CM07 | 客服分配规则 | 根据客户标签、员工状态（空闲/忙碌）、技能标签，自动分配会话给对应客服。 | Drools规则引擎 | 分配准确率≥90% |

### 3.3 消息中心（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| CM08 | 多渠道消息聚合 | 统一展示各平台客户咨询消息（微信、企微、抖音私信、WhatsApp、Facebook Messenger等），按时间倒序，未读标记。 | 消息队列+实时推送 | 消息延迟≤500ms |
| CM09 | 快捷回复 | 支持预设快捷回复（文本/图片/优惠券/商品卡片），一键发送。 | 模板库 | 发送成功率≥99% |
| CM10 | 客户画像侧边栏 | 客服在会话窗口右侧可查看客户画像（会员等级、历史订单、消费偏好、社交账号绑定），快速了解客户。 | 集成CRM与会员系统 | 数据实时展示 |
| CM11 | 会话转接 | 支持将当前会话转接给其他在线客服，附上转接备注。 | 工作流 | 转接记录可查 |
| CM12 | 自动回复 | 配置关键词自动回复或基于知识库的智能回复（AI辅助），降低人工压力。 | 规则引擎+AI NLP | 解决率≥60% |

### 3.4 营销内容分发（P1）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| CM13 | 内容创建 | 支持创建图文、海报、短视频、小程序卡片等多种格式内容，上传素材，系统自动适配各平台尺寸要求。 | 素材处理服务（裁剪/压缩） | 适配成功率≥99% |
| CM14 | 多账号一键分发 | 选择已绑定的多个账号，将内容一键发布到所选平台（支持定时发布）。 | 接口：`POST /api/social/publish` | 发布成功率≥99% |
| CM15 | 发布记录与效果追踪 | 查看各平台发布状态、失败原因，追踪曝光、点赞、评论、转发、转化数据。 | 数据回流 | 数据延迟≤5分钟 |
| CM16 | A/B测试 | 支持创建多个版本素材，自动分配流量，对比效果，输出最优方案。 | 实验平台 | 效果可量化 |

### 3.5 社交关系管理（P1）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| CM17 | 跨平台客户合并 | 根据手机号、邮箱、UnionID等，将同一客户在不同平台的ID合并，构建全域社交画像。 | Neo4j图数据库，实体解析算法。 | 合并准确率≥90% |
| CM18 | 粉丝关系图谱 | 记录客户之间的互动关系（如好友、群成员），用于裂变分析。 | 图数据库 | 关系可查询 |
| CM19 | 标签同步 | 将客户标签（如“KOC”）同步至各平台，实现精准推送。 | 接口：`POST /api/social/tags` | 同步延迟≤1小时 |

### 3.6 自动化营销工作流（P1）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| CM20 | 可视化流程配置 | 拖拽式配置自动化营销流程，如“新粉丝关注→发送欢迎语→48小时后推送优惠券→未使用则短信提醒”。 | 自研工作流引擎 | 流程可配置 |
| CM21 | 跨平台执行 | 支持跨平台执行（如微信上咨询后，可自动发送WhatsApp模板消息，若已绑定）。 | 消息路由 | 执行准确 |
| CM22 | 触发条件 | 支持多种触发条件（关注、消息、订单完成、节日等）。 | 事件监听 | 触发及时 |

### 3.7 数据追踪与分析（P1）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| CM23 | 外链追踪 | 所有分享链接自动添加追踪参数（`utm_source`），确保转化归因准确。 | 短链服务+参数解析 | 归因准确率≥95% |
| CM24 | 互动数据看板 | 展示各平台粉丝增长、互动率（点赞/评论/分享）、转化率，支持按时间、平台、账号筛选。 | 接口：`GET /api/social/stats` | 数据延迟≤5分钟 |
| CM25 | 导出报表 | 支持导出社媒运营报表（Excel/PDF）。 | 接口：`GET /api/social/reports` | 导出≤10秒 |

### 3.8 KOC协同（P2，与KOC体系联动）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| CM26 | KOC任务分发 | KOC在APP中接收推广任务，获取专属素材包（含追踪链接），一键分享至多平台。 | 通讯社媒底座分发接口 | 分发成功率≥99% |
| CM27 | KOC收益看板 | KOC查看各渠道引流人数、核销数、预估收益，实时更新。 | 接口：`GET /api/koc/stats` | 数据实时 |

## 4. 技术架构
- **接入层**：多平台接入网关（Spring Integration + 各平台SDK），支持Webhook统一回调。
- **核心服务**：
  - 账号管理服务：账号绑定、健康度监控。
  - 消息路由服务：会话分配、自动回复、转接。
  - 内容分发服务：素材适配、发布、追踪。
  - 社交关系服务：跨平台客户合并、关系图谱。
  - 自动化营销服务：流程配置、执行引擎。
- **数据**：MySQL（账号、发布记录）、Neo4j（社交关系）、Redis（会话缓存）、ClickHouse（统计数据）。
- **底座依赖**：
  - AI底座：智能回复、内容生成。
  - 语言底座：多语言内容发布。
  - 财务底座：KOC提成结算。

## 5. 接口设计示例
- **绑定账号接口**：
  - `POST /api/social/accounts/bind`
  - 请求：
    ```json
    {
      "platform": "wechat_work",
      "authCode": "xxxx",
      "storeId": 1001
    }
    ```
  - 响应：
    ```json
    {
      "accountId": 5001,
      "status": "active"
    }
    ```

- **发布内容接口**：
  - `POST /api/social/publish`
  - 请求：
    ```json
    {
      "contentType": "图文",
      "title": "新品盲盒上线",
      "content": "...",
      "images": ["url1", "url2"],
      "accounts": [5001, 5002],
      "scheduleTime": "2025-03-03T10:00:00Z"
    }
    ```
  - 响应：`{ "publishId": 6001, "status": "scheduled" }`

- **消息接收Webhook**：
  - `POST /api/social/webhook/{platform}`
  - 各平台回调格式统一转换为内部标准格式后处理。

## 6. 验收标准
- 多平台消息收发延迟<500ms。
- 员工登录同步完成时间<5s。
- 营销内容分发成功率≥99.9%。
- 社媒数据回流延迟<5分钟。
- 支持同时管理≥100个社媒账号/门店。
- 账号健康度监控频率≤1分钟，封号/限流自动告警。
- 符合GDPR/等保2.0：消息内容加密，用户数据脱敏。

## 7. 依赖模块
- **AI底座**：智能回复、内容生成（素材、文案）。
- **语言底座**：多语言内容发布时翻译。
- **财务底座**：KOC提成结算。
- **用户中心**：客户画像数据。
- **KOC系统**：任务分发、收益看板。

---
**版本历史**：
| 版本 | 日期 | 修改内容 | 作者 |
|------|------|----------|------|
| V1.0 | 2025-03-02 | 初始版本，基于总体规划文档及实际岗位需求 | 产品团队 |