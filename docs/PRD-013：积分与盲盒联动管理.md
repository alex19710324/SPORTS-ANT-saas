# PRD-013：积分与盲盒联动管理（适配Trae开发）

## 1. 概述
- **目标用户**：总部运营、门店市场专员、会员系统、盲盒商品管理员、财务人员（成本核算）。
- **核心价值**：构建“积分获取-盲盒消费-积分回流”的闭环体系，通过积分与盲盒的深度联动提升用户粘性与复购率，实现盲盒成本透明化、开箱概率合规化，驱动消费转化。
- **技术目标**：基于Spring Boot + Vue3微服务架构，集成财务底座（成本数据）、AI底座（动态定价）、会员系统（积分变动），支持规则可视化配置，实时数据同步，确保开箱概率公示合规。

## 2. 用户故事
- 作为**会员**，我想要通过消费、运动、分享等方式获取积分，并用积分兑换盲盒或抵扣现金，查看盲盒开箱概率和成本构成，享受透明消费。
- 作为**盲盒商品管理员**，我想要配置盲盒商品信息（价格、库存、开箱概率），设定积分兑换比例，管理成本字段，确保利润可控。
- 作为**运营专员**，我想要配置积分获取规则（如消费1元=1积分）和消耗规则（积分抵扣比例），并推出积分翻倍活动。
- 作为**财务人员**，我想要查看盲盒成本数据与销售利润，确保成本透明化展示与实际核算一致。

## 3. 功能列表（按优先级）

### 3.1 积分体系管理（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| I01 | 积分获取规则配置 | 支持配置积分获取来源（消费、运动参与、盲盒/NFT互动、社交裂变、KOC推广奖励、签到打卡、好友助力等），可设置比例、上下限、有效期。 | 规则引擎，接口：`POST /api/points/rules` | 规则变更实时生效 |
| I02 | 积分消耗规则配置 | 支持配置积分消耗方式（兑换盲盒/NFT/礼品/体验券、消费抵扣、抽奖等），设置抵扣比例（如100积分=1元，最高30%）、兑换所需积分。 | 规则引擎 | 消耗规则准确 |
| I03 | 积分流水查询 | 会员可查看积分获取/消耗明细，支持时间筛选；管理员可全局查询异常流水。 | 接口：`GET /api/points/transactions` | 数据可追溯 |
| I04 | 积分有效期管理 | 积分可设置有效期（如年度清零），过期前30天自动推送提醒。 | 定时任务 + 消息推送 | 提醒送达率≥99% |

### 3.2 盲盒商品管理（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| B01 | 盲盒基础信息配置 | 增删改查盲盒商品，包括名称、系列、图片、IP联动、等级专属、场景限定等属性。 | 接口：`/api/blindboxes` | 商品信息准确 |
| B02 | 价格与库存管理 | 支持设置现金价、积分价，实时库存管理，超卖防护（Redis锁+队列）。 | 库存服务 | 超售率≤0.01% |
| B03 | 开箱概率配置 | 配置各稀有度（SSR/SR/R等）的开箱概率，必须符合监管要求（如总概率100%），配置后需公示。 | 接口：`POST /api/blindboxes/probability` | 概率公示与配置一致 |
| B04 | 成本字段配置 | 支持总部统一设置或门店微调成本字段（物料成本、运营成本、利润），成本数据与商品价格、KOC提成联动（利润低于15%时限制高提成推广）。 | 财务底座对接 | 成本数据实时同步 |

### 3.3 积分与盲盒联动（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| I05 | 积分兑换盲盒 | 会员可使用积分直接兑换盲盒，系统自动扣减积分，生成待提取记录。 | 接口：`POST /api/blindboxes/redeem` | 兑换成功率≥99% |
| I06 | 积分加速卡 | 盲盒开箱随机掉落积分加速卡（如双倍积分卡），会员可激活使用。 | 事件触发 | 加速卡生效准确 |
| I07 | 重复盲盒回收积分 | 会员获得重复盲盒可回收为积分，回收比例与稀有度挂钩。 | 接口：`POST /api/blindboxes/recycle` | 积分到账准确 |
| I08 | KOC专属兑换通道 | KOC享有积分消耗减免特权（如10% off），与KOC等级联动。 | KOC系统对接 | 特权生效准确 |

### 3.4 盲盒玩法创新（P1）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| B05 | 图鉴收集 | 会员收集不同盲盒可点亮图鉴，集齐系列可领取额外奖励。 | 接口：`GET /api/blindboxes/collection` | 图鉴状态实时 |
| B06 | 碎片合成 | 盲盒可拆分为碎片，集齐指定数量碎片可合成稀有款。 | 接口：`POST /api/blindboxes/fragments/synthesize` | 合成逻辑正确 |
| B07 | 预售众筹 | 支持盲盒预售众筹，达到目标数量后生产，未达成则退款。 | 订单系统 + 支付 | 众筹流程完整 |
| B08 | AR潮玩互动预览 | 用户扫描任意平面可生成3D场景，查看盲盒关联IP布局。 | AR引擎（WebAR） | 加载流畅 |

### 3.5 成本透明化展示（P1）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| B09 | 成本构成计算 | 系统根据配置的成本字段（物料、运营、利润）自动计算成本构成，支持价格波动说明（如跨境关税影响）。 | 财务底座 | 计算准确 |
| B10 | 前端渲染 | 盲盒商品详情页自动渲染成本构成（如“物料成本59元+运营成本20元+利润21元=售价100元”），支持点击展开详情。 | 前端组件 | 展示一致 |
| B11 | 成本数据同步 | 成本数据变更后实时清除CDN缓存，确保前端展示与后端核算一致。 | 缓存管理 | 同步延迟≤10秒 |

### 3.6 AI动态定价与推荐（P2）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| B12 | 智能盲盒推荐 | AI底座根据用户偏好、实时热点推荐高转化盲盒，推荐模型每周更新。 | AI底座接口 | 推荐点击率提升15% |
| B13 | 动态成本与价格优化 | AI分析区域消费力、库存、竞品价格，自动建议盲盒售价和成本透明化展示策略（如利润过低时提醒调整）。 | AI模型 | 建议采纳率≥70% |
| B14 | 开箱概率个性化 | 对高价值用户（如KOC），AI可在合规范围内动态调整稀有款概率（波动不超过备案值的10%），提升惊喜感。 | AI底座 + 规则引擎 | 合规记录可查 |

### 3.7 未成年人保护与合规（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| C01 | 未成年人购买限制 | 禁止向未成年人售卖高价值盲盒，购买前需校验实名信息及年龄。 | 实名认证对接 | 阻断违规操作 |
| C02 | 开箱概率公示 | 在盲盒详情页显著位置展示开箱概率，并附监管备案号（国内），海外需符合当地赌博法规。 | 前端固定模块 | 公示清晰 |
| C03 | 购买前弹窗确认 | 购买前弹窗“已知晓开箱概率，理性消费”，用户确认后方可下单。 | 前端交互 | 100%弹窗 |

## 4. 技术架构
- **前端**：Vue3（小程序/后台），集成成本透明化组件、AR预览组件。
- **后端**：Spring Boot微服务，独立盲盒模块、积分模块。
- **数据**：MySQL（盲盒、积分规则、流水）、Redis（库存、热门数据）、ClickHouse（分析报表）。
- **底座依赖**：
  - AI底座：智能推荐、动态定价。
  - 财务底座：成本数据、利润核算。
  - 会员系统：积分变动。
  - KOC系统：专属权益。
  - 订单系统：交易记录。

## 5. 接口设计示例
- **积分兑换盲盒**：
  - `POST /api/blindboxes/redeem`
  - 请求：
    ```json
    {
      "blindboxId": 2001,
      "userId": 12345,
      "redeemType": "points",
      "points": 500
    }
    ```
  - 响应：
    ```json
    {
      "orderId": 3001,
      "qrCode": "url_to_qrcode",
      "remainingPoints": 4500
    }
    ```

- **盲盒成本查询**：
  - `GET /api/blindboxes/2001/cost?region=CN`
  - 响应：
    ```json
    {
      "materialCost": 59.00,
      "operatingCost": 20.00,
      "profit": 21.00,
      "total": 100.00,
      "currency": "CNY",
      "note": "含跨境关税"
    }
    ```

## 6. 验收标准
- 积分规则配置后实时生效，流水可追溯。
- 盲盒库存实时准确，无超卖。
- 开箱概率公示与配置一致，合规。
- 成本透明化数据与财务核算一致。
- 未成年人购买阻断准确率100%。

## 7. 依赖模块
- **AI底座**：智能推荐、动态定价。
- **财务底座**：成本数据。
- **会员系统**：积分、实名信息。
- **KOC系统**：专属权益。
- **订单系统**：交易记录。

---
**版本历史**：
| 版本 | 日期 | 修改内容 | 作者 |
|------|------|----------|------|
| V1.0 | 2025-03-02 | 初始版本，基于总体规划文档 | 产品团队 |