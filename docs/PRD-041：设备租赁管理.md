# PRD-041：设备租赁管理（适配Trae开发）

## 1. 概述
- **目标用户**：门店前台、导玩员、顾客、技术员、财务人员。
- **核心价值**：实现门店可租赁设备（如VR头显、运动手环、游戏手柄、护具等）的数字化管理，支持在线租赁、计时计费、押金管理、归还验收、自动结算，提升设备周转率和用户体验。
- **技术目标**：基于Spring Boot + Vue3微服务架构，集成物联网设备绑定、计时引擎、押金支付、财务底座，支持多种租赁模式（按时/按天/套餐），租赁自动化率≥95%。

## 2. 用户故事
- 作为**顾客**，我想租赁一套VR设备，在小程序上选择租赁时长，支付押金和租金，到店扫码取设备，用完归还后押金自动退回。
- 作为**前台**，顾客归还设备时，我扫码验收设备完好，系统自动计算租金并退款押金。
- 作为**店长**，我想要查看设备租赁收入、设备利用率、损耗率，优化租赁定价。

## 3. 功能列表（按优先级）

### 3.1 租赁商品管理（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| RE01 | 设备类型配置 | 管理可租赁设备类型（VR头显、手柄、护具、手环），设置押金、租金（时租/日租）、超时费率。 | 接口：`/api/rental/products` | 配置灵活 |
| RE02 | 设备库存 | 每个类型下管理具体设备编号、状态（可租/已租/维修/报废），支持RFID/二维码标识。 | 库存服务 | 状态实时 |
| RE03 | 租赁套餐 | 支持组合套餐（如VR头显+手柄+游戏），设置套餐价。 | 规则引擎 | 套餐生效 |

### 3.2 在线租赁（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| RE04 | 租赁下单 | 顾客在小程序选择设备、时长，支付押金+租金，生成租赁订单。 | 接口：`POST /api/rental/orders` | 下单成功率≥99% |
| RE05 | 押金支付 | 支持微信/支付宝预授权或单独支付押金，冻结金额。 | 支付网关 | 押金安全 |
| RE06 | 取设备 | 顾客到店出示取货码，前台扫码确认，设备状态变更为“已租”，计时开始。 | 接口：`POST /api/rental/pickup` | 状态更新及时 |

### 3.3 归还与结算（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| RE07 | 归还验收 | 前台扫码设备，检查完好情况，如有损坏填写扣款金额。 | 接口：`POST /api/rental/return` | 验收记录 |
| RE08 | 费用计算 | 系统根据实际租赁时长计算租金，从押金中扣除，剩余自动原路退回。 | 计费引擎 | 计算准确 |
| RE09 | 超时处理 | 超时未归，系统自动提醒顾客，并按规则扣费。 | 定时任务 | 处理准确 |

### 3.4 租赁监控与分析（P1）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| RE10 | 租赁看板 | 展示当前租赁中设备数量、待归还列表、逾期列表。 | 接口：`GET /api/rental/dashboard` | 实时刷新 |
| RE11 | 设备利用率 | 统计各类设备使用时长、周转率、故障率。 | 数据中台 | 报表清晰 |
| RE12 | 租赁收入报表 | 按月/季度统计租赁收入，与财务对账。 | 财务底座 | 数据准确 |

## 4. 技术架构
- **前端**：小程序（用户端）、Vue3后台（管理端）。
- **后端**：Spring Boot + 租赁微服务。
- **数据**：MySQL（订单、设备）、Redis（计时）、Elasticsearch（日志）。
- **底座依赖**：
  - 支付网关：押金支付。
  - 财务底座：结算。
  - 数据中台：分析。

## 5. 接口设计示例
- **租赁下单**：
  - `POST /api/rental/orders`
  - 请求：
    ```json
    {
      "productId": 2001,
      "duration": 2,
      "durationUnit": "hour",
      "quantity": 1
    }
    ```

## 6. 验收标准
- 租赁下单支付流程顺畅。
- 计时计费准确无误。
- 押金自动退还成功。
- 设备状态实时同步。

## 7. 依赖模块
- **支付网关**：押金。
- **财务底座**：结算。
- **数据中台**：分析。

---
**版本历史**：
| 版本 | 日期 | 修改内容 | 作者 |
|------|------|----------|------|
| V1.0 | 2025-03-03 | 初始版本 | 产品团队 |