# PRD-058：优惠券/卡券管理（适配Trae开发）

## 1. 概述
- **目标用户**：市场运营、门店店长、会员运营、财务人员。
- **核心价值**：构建统一的优惠券/卡券管理平台，支持多种券类型（折扣券、代金券、买赠券、体验券）的创建、发放、核销、风控、分析，提升营销灵活性与转化率。
- **技术目标**：基于Spring Boot + Vue3微服务架构，集成券码生成引擎、规则引擎、财务底座（成本核算）、通讯社媒底座（推送），支持防刷、限领、过期提醒，核销成功率≥99.99%。

## 2. 用户故事
- 作为**市场运营**，我想要创建一批“满100减20”代金券，设置每人限领1张，有效期30天，通过小程序推送发给高价值会员。
- 作为**收银员**，顾客出示优惠券二维码，我扫码核销，系统自动验证有效性并扣减金额。
- 作为**财务人员**，我需要统计本月优惠券发放数量、核销数量、总优惠金额，分析活动ROI。

## 3. 功能列表（按优先级）

### 3.1 券类型与模板（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| CP01 | 券类型配置 | 支持折扣券、代金券、买赠券、体验券、兑换券等多种类型。 | 规则引擎 | 类型可扩展 |
| CP02 | 券模板创建 | 设置券名称、面值、使用门槛、适用商品/项目、有效期、发放总量。 | 接口：`POST /api/coupon/templates` | 创建成功 |
| CP03 | 使用规则 | 可配置每人限领、每日限用、叠加规则、不可与XX同用。 | 规则引擎 | 规则生效 |

### 3.2 发放管理（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| CP04 | 主动发放 | 选择用户/人群包，一键发放优惠券，系统自动推送通知。 | 接口：`POST /api/coupon/issue` | 发放成功 |
| CP05 | 用户领取 | 用户可在小程序领取中心自行领取，支持秒杀、限量。 | 接口：`POST /api/coupon/receive` | 领取准确 |
| CP06 | 导入券码 | 支持外部券码（如实体券）导入系统，绑定后用于核销。 | 文件导入 | 导入成功 |

### 3.3 核销管理（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| CP07 | 核销验证 | 用户出示券码（二维码/条形码），系统验证有效性、使用条件。 | 接口：`POST /api/coupon/verify` | 响应≤1秒 |
| CP08 | 核销撤销 | 支持误操作撤销核销（需权限），记录日志。 | 接口：`POST /api/coupon/reverse` | 撤销成功 |

### 3.4 风控与监控（P1）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| CP09 | 防刷机制 | 监控同一IP/设备频繁领取，自动加入黑名单。 | 风控引擎 | 拦截准确 |
| CP10 | 过期提醒 | 优惠券过期前3天自动推送提醒用户使用。 | 定时任务 + 消息中心 | 提醒及时 |

### 3.5 数据分析（P2）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| CP11 | 券报表 | 统计发放量、核销量、核销率、优惠金额、拉新效果。 | 数据中台 | 报表清晰 |

## 4. 技术架构
- **前端**：Vue3（后台）、小程序（用户端）。
- **后端**：Spring Boot + 券微服务。
- **数据**：MySQL（券模板、券实例）、Redis（库存、限领）、Elasticsearch（日志）。
- **底座依赖**：
  - 消息通知中心：提醒。
  - 财务底座：成本核算。
  - 数据中台：分析。

## 5. 接口设计示例
- **创建优惠券模板**：
  - `POST /api/coupon/templates`
  - 请求：
    ```json
    {
      "name": "满100减20",
      "type": "discount",
      "value": 20,
      "threshold": 100,
      "total": 10000,
      "perUserLimit": 1,
      "startTime": "2025-04-01",
      "endTime": "2025-04-30"
    }
    ```

## 6. 验收标准
- 券模板创建后实时生效。
- 发放/领取准确无误。
- 核销响应≤1秒。
- 风控拦截有效。

---
**版本历史**：V1.0 2025-03-03