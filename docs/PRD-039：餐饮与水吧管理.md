# PRD-039：餐饮与水吧管理（适配Trae开发）

## 1. 概述
- **目标用户**：调酒师/水吧员、厨房人员、店长、财务人员、顾客。
- **核心价值**：实现门店餐饮水吧业务的数字化管理，包括菜单配置、点单收银、库存管理、食品安全、成本核算、销售分析，提升服务效率与顾客体验，保障食品安全合规。
- **技术目标**：基于Spring Boot + Vue3微服务架构，集成POS系统、库存引擎、财务底座、食品安全监测，支持移动点单、后厨打印、库存预警、成本分析，点单响应≤2秒。

## 2. 用户故事
- 作为**水吧员**，顾客扫码点单后，我在后厨屏幕上看到订单，制作完成后通知取餐，系统自动扣减原料库存。
- 作为**厨房人员**，我需要定期检查食材保质期，系统自动预警临期食材，避免浪费。
- 作为**店长**，我想要查看餐饮水吧的营收占比、畅销单品、毛利分析，优化菜单。
- 作为**顾客**，我在小程序上浏览饮品菜单，下单支付，收到取餐通知，全程无需排队。

## 3. 功能列表（按优先级）

### 3.1 菜单管理（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| FB01 | 菜品分类 | 支持多级分类（饮品、小吃、套餐、主食），可设置显示顺序。 | 接口：`/api/fnb/categories` | 分类灵活 |
| FB02 | 菜品管理 | 增删改查菜品信息，包括名称、图片、价格、规格、口味选项、库存关联。 | 接口：`/api/fnb/items` | 信息准确 |
| FB03 | 套餐组合 | 支持创建套餐，包含多个单品，可设置套餐价格。 | 规则引擎 | 套餐生效 |
| FB04 | 时令/限量 | 支持设置菜品时令（如季节限定）、每日限量，售罄自动隐藏。 | 定时任务 | 自动更新 |

### 3.2 点单与收银（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| FB05 | 扫码点单 | 顾客扫描桌台二维码，浏览菜单，加入购物车，在线支付，订单推送至后厨。 | 小程序 + WebSocket | 点单成功率≥99% |
| FB06 | 收银台点单 | 前台/水吧员在POS系统为顾客点单，支持现金、会员卡、组合支付。 | 接口：`POST /api/fnb/orders` | 支付成功 |
| FB07 | 后厨打印/KDS | 订单自动分发至对应制作区（水吧/厨房），显示在屏幕上或打印小票。 | 打印机驱动/KDS | 打印成功率≥99% |
| FB08 | 取餐通知 | 制作完成后，系统推送取餐通知（小程序/短信/叫号屏）。 | 通讯社媒底座 | 通知及时 |

### 3.3 库存管理（P1）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| FB09 | 原料管理 | 管理原料信息（名称、单位、供应商、采购价、库存量、保质期）。 | 接口：`/api/fnb/ingredients` | 信息完整 |
| FB10 | 配方管理 | 每个菜品关联原料配方（如一杯奶茶需牛奶200ml、茶包1个），自动计算理论库存消耗。 | 规则引擎 | 配方准确 |
| FB11 | 自动扣库存 | 每笔订单完成后，自动扣减对应原料库存。 | 库存引擎 | 实时同步 |
| FB12 | 库存预警 | 原料低于安全库存时自动生成补货建议；临期原料提前预警。 | 规则引擎 | 预警准确 |
| FB13 | 盘点管理 | 支持定期盘点，录入实盘数量，自动生成盘盈盘亏单。 | 接口：`POST /api/fnb/inventory/check` | 盘点闭环 |

### 3.4 食品安全与合规（P1）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| FB14 | 保质期监控 | 实时监控原料保质期，临期/过期自动预警并禁止使用。 | 定时任务 | 预警及时 |
| FB15 | 留样管理 | 支持记录食品留样信息（时间、菜品、责任人、照片）。 | 接口：`POST /api/fnb/samples` | 记录可查 |
| FB16 | 员工健康证管理 | 关联餐饮员工健康证信息，到期前提醒。 | HR系统联动 | 提醒及时 |

### 3.5 成本与销售分析（P2）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| FB17 | 成本计算 | 根据原料采购价和配方，自动计算每道菜品的理论成本。 | 财务底座 | 计算准确 |
| FB18 | 毛利分析 | 统计各菜品销售额、成本、毛利、毛利率，支持排行。 | 数据中台 | 报表清晰 |
| FB19 | 畅销分析 | 分析菜品销售趋势、时段热度，辅助菜单优化。 | 数据中台 | 分析可用 |

## 4. 技术架构
- **前端**：小程序（顾客点单）、Vue3 POS/后台。
- **后端**：Spring Boot + 餐饮微服务。
- **数据**：MySQL（菜单、订单）、Redis（库存）、Elasticsearch（日志）。
- **底座依赖**：
  - 财务底座：成本、毛利。
  - 通讯社媒底座：取餐通知。
  - 数据中台：销售分析。
  - HR系统：健康证。

## 5. 接口设计示例
- **顾客点单**：
  - `POST /api/fnb/orders`
  - 请求：
    ```json
    {
      "storeId": 1001,
      "tableNo": "A12",
      "items": [
        { "itemId": 2001, "quantity": 2, "options": { "sugar": "半糖" } }
      ],
      "paymentMethod": "wechat"
    }
    ```
  - 响应：`{ "orderId": 3001, "estimatedWaitTime": 5 }`

## 6. 验收标准
- 扫码点单流程顺畅，支付成功率≥99%。
- 库存扣减实时准确。
- 成本计算与财务一致。
- 食品安全预警及时。

## 7. 依赖模块
- **财务底座**：成本。
- **通讯社媒底座**：通知。
- **数据中台**：分析。
- **HR系统**：健康证。

---
**版本历史**：
| 版本 | 日期 | 修改内容 | 作者 |
|------|------|----------|------|
| V1.0 | 2025-03-03 | 初始版本 | 产品团队 |