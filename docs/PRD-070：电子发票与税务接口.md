# PRD-070：电子发票与税务接口（适配Trae开发）

## 1. 概述
- **目标用户**：财务人员、顾客、税务专员。
- **核心价值**：对接税局电子发票平台（如百望、票通），实现发票自动开具、推送、红冲、查验，支持增值税专用发票/普通发票，提升财务效率。
- **技术目标**：基于财务底座，集成电子发票API，支持多税号、多门店，发票开具成功率≥99.9%。

## 2. 用户故事
- 作为**顾客**，我在消费后申请开具发票，填写抬头和邮箱，电子发票自动发送。
- 作为**财务**，我需要批量开具发票，查看开票额度，处理红冲申请。

## 3. 功能列表（按优先级）

### 3.1 发票配置（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| IN01 | 税号管理 | 配置各门店税号、开票限额、电子发票平台对接参数。 | 接口：`/api/invoice/config` | 配置生效 |
| IN02 | 开票规则 | 设置哪些业务（门票、商品）可开票，开票类型（专票/普票）。 | 规则引擎 | 规则准确 |

### 3.2 开票管理（P0）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| IN03 | 用户申请开票 | 用户在订单详情申请开票，填写抬头、税号、邮箱。 | 接口：`POST /api/invoice/apply` | 申请成功 |
| IN04 | 自动开票 | 系统调用税局接口开具电子发票，推送至用户邮箱/小程序。 | 定时任务 + API | 成功率≥99.9% |
| IN05 | 批量开票 | 财务可批量选中订单，一键开票。 | 接口：`POST /api/invoice/batch` | 开票成功 |

### 3.3 红冲与查验（P1）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| IN06 | 红冲申请 | 申请发票红冲，需填写原因，审批后调用红冲接口。 | 工作流 | 流程完整 |
| IN07 | 发票查验 | 支持手动或自动调用税局接口查验发票真伪。 | 接口：`GET /api/invoice/verify` | 查验准确 |

### 3.4 统计报表（P2）

| ID | 功能名称 | 描述 | 技术实现要点 | 验收标准 |
|----|----------|------|--------------|----------|
| IN08 | 开票统计 | 统计开票金额、数量、剩余额度，生成报表。 | 数据中台 | 清晰准确 |

## 4. 依赖模块
- 财务底座（PRD-009）
- 订单系统（PRD-001）

---
**版本历史**：V1.0 2025-03-03